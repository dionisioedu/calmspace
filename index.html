<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CalmSpace - Novo Layout</title>
    <style>
        body {
            margin: 0;
            min-height: 100vh;
            overflow-x: hidden;
            background: linear-gradient(45deg, #a7f3d0, #c4b5fd, #bae6fd);
            background-size: 300% 300%;
            animation: gradientBG 20s ease infinite;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-family: 'Arial', sans-serif;
            padding: 20px;
            box-sizing: border-box;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .container {
            text-align: center;
            color: #fff;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            z-index: 10;
            max-width: 100%;
        }

        .row {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            margin: 15px 0;
            gap: 10px;
        }

        .sound-button {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            transition: transform 0.1s, opacity 0.3s;
        }
        .sound-button:hover { box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3); }
        .sound-button:active { transform: scale(0.9); opacity: 0.8; }

        .knob {
            width: 80px;
            height: 80px;
            background: radial-gradient(#fff, #d1d5db);
            border-radius: 50%;
            position: relative;
            cursor: grab;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        .knob::after {
            content: '';
            position: absolute;
            width: 8px;
            height: 16px;
            background: #4b5563;
            top: 8px;
            left: 50%;
            transform: translateX(-50%);
            border-radius: 4px;
        }

        .scribble-area, .coloring-area {
            width: 400px;
            height: 200px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            overflow: hidden;
        }
        canvas { width: 100%; height: 100%; touch-action: none; }

        .controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 10px;
        }
        .scribble-btn {
            padding: 8px 12px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            background: #fff;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .piano {
            display: flex;
            gap: 2px;
        }
        .key {
            width: 40px;
            height: 120px;
            border-radius: 10px;
            border: none;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            transition: transform 0.1s;
        }
        .key.white { background: #fff; }
        .key.black { 
            width: 25px;
            height: 80px;
            background: #333;
            margin-left: -12.5px;
            margin-right: -12.5px;
            z-index: 1;
        }
        .key:active { transform: scale(0.95); }

        .mute-btn {
            position: fixed;
            top: 10px;
            right: 10px;
            padding: 8px 12px;
            background: #ef4444;
            border: none;
            border-radius: 5px;
            color: #fff;
            cursor: pointer;
            z-index: 20;
        }

        @media (max-width: 600px) {
            .sound-button, .knob { width: 50px; height: 50px; }
            .scribble-area, .coloring-area { width: 90vw; height: 150px; }
            .key.white { width: 30px; height: 100px; }
            .key.black { width: 20px; height: 60px; margin-left: -10px; margin-right: -10px; }
            h1 { font-size: 1.5em; }
            p { font-size: 0.9em; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>CalmSpace</h1>
        <p>Brinque e encontre sua calma</p>
        <div class="row">
            <button class="sound-button" id="btn1"></button>
            <button class="sound-button" id="btn2"></button>
            <button class="sound-button" id="btn3"></button>
        </div>
        <div class="row">
            <div class="coloring-area"><canvas id="coloring-canvas"></canvas></div>
        </div>
        <div class="controls">
            <button class="scribble-btn" id="clear-coloring">Limpar Colorir</button>
            <input type="color" id="color-picker" value="#ff6b6b">
        </div>
        <div class="row">
            <div class="knob" id="knob1"></div>
            <div class="knob" id="knob2"></div>
            <div class="knob" id="knob3"></div>
        </div>
        <div class="row">
            <div class="scribble-area"><canvas id="scribble-canvas"></canvas></div>
        </div>
        <div class="controls">
            <button class="scribble-btn" id="clear-scribble">Limpar Rabiscos</button>
            <input type="range" id="line-width" min="1" max="20" value="5">
        </div>
        <div class="row">
            <div class="piano" id="piano"></div>
        </div>
    </div>
    <button class="mute-btn" id="mute-btn">Mute</button>

    <script>
        // Sons
        const sounds = {
            btn1: new Audio('sounds/button-38.mp3'),
            btn2: new Audio('sounds/bloop-1.mp3'),
            btn3: new Audio('sounds/button-3.mp3'),
            knob1: new Audio('https://www.myinstants.com/media/sounds/click.mp3'),
            knob2: new Audio('sounds/happy-pop-1.mp3'),
            knob3: new Audio('sounds/multi-pop-1.mp3'),
            fill: new Audio('sounds/multi-pop-1.mp3')
        };
        let isMuted = false;

        // Mute
        const muteBtn = document.getElementById('mute-btn');
        muteBtn.addEventListener('click', () => {
            isMuted = !isMuted;
            muteBtn.textContent = isMuted ? 'Unmute' : 'Mute';
            muteBtn.style.background = isMuted ? '#22c55e' : '#ef4444';
        });

        function playSound(sound) {
            if (!isMuted) {
                sound.currentTime = 0;
                sound.play();
            }
        }

        // Botões sonoros com mudança de cor
        document.querySelectorAll('.sound-button').forEach(btn => {
            btn.style.background = `hsl(${Math.random() * 360}, 70%, 70%)`;
            btn.addEventListener('click', () => {
                btn.style.background = `hsl(${Math.random() * 360}, 70%, 70%)`;
                playSound(sounds[btn.id]);
            });
            btn.addEventListener('touchstart', (e) => {
                e.preventDefault();
                btn.style.background = `hsl(${Math.random() * 360}, 70%, 70%)`;
                playSound(sounds[btn.id]);
            });
        });

        // Knobs giratórios
        function setupKnob(knobId, soundKey) {
            const knob = document.getElementById(knobId);
            let isDragging = false;
            let angle = 0;

            const startDrag = () => { isDragging = true; };
            const stopDrag = () => { isDragging = false; };
            const drag = (e) => {
                if (isDragging) {
                    angle += 5;
                    knob.style.transform = `rotate(${angle}deg)`;
                    playSound(sounds[soundKey]);
                }
            };

            knob.addEventListener('mousedown', startDrag);
            knob.addEventListener('touchstart', (e) => { e.preventDefault(); startDrag(); });
            document.addEventListener('mouseup', stopDrag);
            document.addEventListener('touchend', stopDrag);
            document.addEventListener('mousemove', drag);
            document.addEventListener('touchmove', (e) => {
                e.preventDefault();
                drag({ clientX: e.touches[0].clientX, clientY: e.touches[0].clientY });
            });
        }
        setupKnob('knob1', 'knob1');
        setupKnob('knob2', 'knob2');
        setupKnob('knob3', 'knob3');

        // Área de colorir
        const coloringCanvas = document.getElementById('coloring-canvas');
        const coloringCtx = coloringCanvas.getContext('2d');
        const clearColoringBtn = document.getElementById('clear-coloring');
        const colorPicker = document.getElementById('color-picker');
        coloringCanvas.width = 400;
        coloringCanvas.height = 200;

        function drawRandomLines() {
            coloringCtx.clearRect(0, 0, coloringCanvas.width, coloringCanvas.height);
            coloringCtx.strokeStyle = '#000';
            coloringCtx.lineWidth = 1;

            for (let i = 0; i < 20; i++) {
                coloringCtx.beginPath();
                coloringCtx.moveTo(Math.random() * coloringCanvas.width, Math.random() * coloringCanvas.height);
                coloringCtx.lineTo(Math.random() * coloringCanvas.width, Math.random() * coloringCanvas.height);
                coloringCtx.stroke();
            }
        }
        drawRandomLines();

        function floodFill(x, y, fillColor) {
            const imageData = coloringCtx.getImageData(0, 0, coloringCanvas.width, coloringCanvas.height);
            const data = imageData.data;
            const targetColor = getPixelColor(x, y, data);
            if (colorsMatch(targetColor, hexToRgb(fillColor))) return;

            const stack = [[x, y]];
            while (stack.length) {
                const [currX, currY] = stack.pop();
                const pos = (currY * coloringCanvas.width + currX) * 4;
                if (currX < 0 || currX >= coloringCanvas.width || currY < 0 || currY >= coloringCanvas.height) continue;
                if (!colorsMatch(getPixelColor(currX, currY, data), targetColor)) continue;

                data[pos] = hexToRgb(fillColor)[0];
                data[pos + 1] = hexToRgb(fillColor)[1];
                data[pos + 2] = hexToRgb(fillColor)[2];
                data[pos + 3] = 255;

                stack.push([currX + 1, currY]);
                stack.push([currX - 1, currY]);
                stack.push([currX, currY + 1]);
                stack.push([currX, currY - 1]);
            }
            coloringCtx.putImageData(imageData, 0, 0);
            playSound(sounds.fill);
        }

        function getPixelColor(x, y, data) {
            const pos = (y * coloringCanvas.width + x) * 4;
            return [data[pos], data[pos + 1], data[pos + 2], data[pos + 3]];
        }

        function colorsMatch(c1, c2) {
            return c1[0] === c2[0] && c1[1] === c2[1] && c1[2] === c2[2] && c1[3] === c2[3];
        }

        function hexToRgb(hex) {
            const r = parseInt(hex.slice(1, 3), 16);
            const g = parseInt(hex.slice(3, 5), 16);
            const b = parseInt(hex.slice(5, 7), 16);
            return [r, g, b, 255];
        }

        coloringCanvas.addEventListener('click', (e) => {
            const rect = coloringCanvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            floodFill(Math.floor(x), Math.floor(y), colorPicker.value);
        });
        coloringCanvas.addEventListener('touchstart', (e) => {
            e.preventDefault();
            const rect = coloringCanvas.getBoundingClientRect();
            const x = e.touches[0].clientX - rect.left;
            const y = e.touches[0].clientY - rect.top;
            floodFill(Math.floor(x), Math.floor(y), colorPicker.value);
        });

        clearColoringBtn.addEventListener('click', () => {
            drawRandomLines();
            playSound(sounds.btn1);
        });

        // Área de rabiscos
        const scribbleCanvas = document.getElementById('scribble-canvas');
        const scribbleCtx = scribbleCanvas.getContext('2d');
        const lineWidth = document.getElementById('line-width');
        const clearScribbleBtn = document.getElementById('clear-scribble');
        scribbleCanvas.width = 400;
        scribbleCanvas.height = 200;
        let isDrawing = false;

        scribbleCtx.lineCap = 'round';
        scribbleCtx.lineJoin = 'round';

        function startDrawing(e) {
            isDrawing = true;
            scribbleCtx.beginPath();
            scribbleCtx.moveTo(e.offsetX || e.touches[0].clientX - scribbleCanvas.offsetLeft, 
                              e.offsetY || e.touches[0].clientY - scribbleCanvas.offsetTop);
            scribbleCtx.strokeStyle = colorPicker.value;
            scribbleCtx.lineWidth = lineWidth.value;
            playSound(sounds.knob3);
        }

        function draw(e) {
            if (!isDrawing) return;
            const x = e.offsetX || e.touches[0].clientX - scribbleCanvas.offsetLeft;
            const y = e.offsetY || e.touches[0].clientY - scribbleCanvas.offsetTop;
            scribbleCtx.lineTo(x, y);
            scribbleCtx.stroke();
        }

        function stopDrawing() { isDrawing = false; }

        scribbleCanvas.addEventListener('mousedown', startDrawing);
        scribbleCanvas.addEventListener('mousemove', draw);
        scribbleCanvas.addEventListener('mouseup', stopDrawing);
        scribbleCanvas.addEventListener('touchstart', (e) => { e.preventDefault(); startDrawing(e); });
        scribbleCanvas.addEventListener('touchmove', (e) => { e.preventDefault(); draw(e); });
        scribbleCanvas.addEventListener('touchend', stopDrawing);

        clearScribbleBtn.addEventListener('click', () => {
            scribbleCtx.clearRect(0, 0, scribbleCanvas.width, scribbleCanvas.height);
            playSound(sounds.btn1);
        });

        // Piano
        const piano = document.getElementById('piano');
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        const notes = ['C4', 'D4', 'E4', 'F4', 'G4', 'A4', 'B4', 'C5']; // Escala simples
        const blackNotes = [1, 3, 6]; // Posições das teclas pretas

        notes.forEach((note, index) => {
            const key = document.createElement('button');
            key.className = `key ${blackNotes.includes(index) ? 'black' : 'white'}`;
            key.dataset.note = note;
            piano.appendChild(key);

            key.addEventListener('click', () => playNote(note));
            key.addEventListener('touchstart', (e) => {
                e.preventDefault();
                playNote(note);
            });
        });

        function playNote(note) {
            const oscillator = audioContext.createOscillator();
            oscillator.type = 'sine';
            oscillator.frequency.value = noteToFrequency(note);
            oscillator.connect(audioContext.destination);
            oscillator.start();
            setTimeout(() => oscillator.stop(), 300);
        }

        function noteToFrequency(note) {
            const frequencies = {
                'C4': 261.63, 'C#4': 277.18, 'D4': 293.66, 'D#4': 311.13,
                'E4': 329.63, 'F4': 349.23, 'F#4': 369.99, 'G4': 392.00,
                'G#4': 415.30, 'A4': 440.00, 'A#4': 466.16, 'B4': 493.88,
                'C5': 523.25
            };
            return frequencies[note];
        }
    </script>
</body>
</html>