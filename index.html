<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CalmSpace</title>
    <!-- AdSense Script -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6858130394830057"
            crossorigin="anonymous"></script>
    <style>
        body {
            margin: 0;
            min-height: 100vh;
            overflow-x: hidden;
            background: linear-gradient(45deg, #a7f3d0, #c4b5fd, #bae6fd);
            background-size: 300% 300%;
            animation: gradientBG 20s ease infinite;
            font-family: 'Arial', sans-serif;
            display: flex;
            flex-direction: column;
            padding: 0;
            box-sizing: border-box;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        header {
            background: rgba(255, 255, 255, 0.2);
            padding: 8px;
            text-align: center;
            color: #fff;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            width: 100%;
        }
        header h1 {
            font-size: 1.5em;
            margin: 0;
        }
        header p {
            font-size: 0.9em;
            margin: 2px 0 0;
        }

        footer {
            background: rgba(255, 255, 255, 0.2);
            padding: 10px;
            text-align: center;
            color: #fff;
            font-size: 0.9em;
            width: 100%;
            margin-top: auto;
        }
        footer a {
            color: #fff;
            text-decoration: none;
            font-weight: bold;
        }
        footer a:hover { text-decoration: underline; }

        .container {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            max-width: 100%;
        }

        .row {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            margin: 15px 0;
            gap: 15px;
            width: 100%;
        }

        .sound-buttons-row {
            justify-content: space-between;
            width: 400px;
            gap: 15px;
            flex-wrap: nowrap; /* Impede quebra de linha */
        }

        .sound-button {
            width: 89px; /* Tamanho padrão, ajustado dinamicamente se necessário */
            height: 89px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            transition: transform 0.1s, opacity 0.3s;
            flex-shrink: 1; /* Permite encolher se necessário */
        }
        .sound-button:hover { box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3); }
        .sound-button:active { transform: scale(0.9); opacity: 0.8; }

        .knob {
            width: 120px; /* Aumentado 50% de 80px */
            height: 120px;
            background: radial-gradient(#fff, #d1d5db);
            border-radius: 50%;
            position: relative;
            cursor: grab;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        .knob::after {
            content: '';
            position: absolute;
            width: 12px; /* Ajustado proporcionalmente */
            height: 24px;
            background: #4b5563;
            top: 12px;
            left: 50%;
            transform: translateX(-50%);
            border-radius: 4px;
        }

        .scribble-area, .coloring-area {
            width: 400px;
            height: 200px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            overflow: hidden;
        }
        canvas { width: 100%; height: 100%; touch-action: none; }

        .controls {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            width: 400px;
        }
        .clear-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            background: #60a5fa;
            color: #fff;
            font-weight: bold;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            transition: background 0.3s, transform 0.1s;
        }
        .clear-btn:hover { background: #3b82f6; }
        .clear-btn:active { transform: scale(0.95); }

        .color-picker {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            justify-content: center;
            width: 100%;
        }
        .color-option {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
            transition: border 0.2s, transform 0.2s;
        }
        .color-option:hover { border: 2px solid #fff; transform: scale(1.1); }
        .color-option.selected { border: 2px solid #000; }

        .piano {
            display: flex;
            gap: 2px;
            width: 400px;
        }
        .key {
            height: 120px;
            border-radius: 10px;
            border: none;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            transition: transform 0.1s;
        }
        .key.white { 
            width: 57px;
            background: hsl(0, 70%, 90%);
        }
        .key.black { 
            width: 35px;
            height: 80px;
            margin-left: -17.5px;
            margin-right: -17.5px;
            z-index: 1;
            background: hsl(0, 50%, 30%);
        }
        .key:active { transform: scale(0.95); }

        .mute-btn {
            position: fixed;
            top: 10px;
            right: 10px;
            padding: 8px 12px;
            background: #ef4444;
            border: none;
            border-radius: 5px;
            color: #fff;
            cursor: pointer;
            z-index: 20;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            transition: background 0.3s, transform 0.1s;
        }
        .mute-btn:hover { background: #dc2626; }
        .mute-btn:active { transform: scale(0.95); }

        .content-section {
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            color: #333;
            text-align: justify;
        }
        .content-section h2 {
            color: #fff;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
            text-align: center;
        }

        @media (max-width: 600px) {
            .sound-button { width: calc((90vw - 45px) / 4); height: calc((90vw - 45px) / 4); }
            .knob { width: 75px; height: 75px; } /* Aumentado 50% de 50px */
            .knob::after { width: 7.5px; height: 15px; top: 7.5px; }
            .scribble-area, .coloring-area { width: 90vw; height: 150px; }
            .sound-buttons-row, .controls, .piano { width: 90vw; }
            .key.white { width: calc((90vw - 8px) / 7); height: 100px; }
            .key.black { width: calc(((90vw - 8px) / 7) * 0.6); height: 60px; margin-left: calc(-((90vw - 8px) / 7) * 0.3); margin-right: calc(-((90vw - 8px) / 7) * 0.3); }
            header h1 { font-size: 1.2em; }
            header p { font-size: 0.8em; }
            footer p { font-size: 0.8em; }
            .row { gap: 10px; }
            .controls { gap: 10px; }
            .content-section { margin: 10px; padding: 15px; }
        }
    </style>
</head>
<body>
    <header>
        <h1>CalmSpace</h1>
        <p>A space to relax and have fun</p>
    </header>
    <div class="container">
        <div class="row sound-buttons-row">
            <button class="sound-button" id="btn1"></button>
            <button class="sound-button" id="btn2"></button>
            <button class="sound-button" id="btn3"></button>
            <button class="sound-button" id="btn4"></button>
        </div>
        <div class="row">
            <div class="coloring-area"><canvas id="coloring-canvas"></canvas></div>
        </div>
        <div class="controls">
            <button class="clear-btn" id="clear-coloring">Clear Coloring</button>
            <div class="color-picker" id="color-picker"></div>
        </div>
        <div class="row">
            <div class="knob" id="knob1"></div>
            <div class="knob" id="knob2"></div>
            <div class="knob" id="knob3"></div>
        </div>
        <div class="row">
            <div class="scribble-area"><canvas id="scribble-canvas"></canvas></div>
        </div>
        <div class="controls">
            <button class="clear-btn" id="clear-scribble">Clear Scribbles</button>
            <input type="range" id="line-width" min="1" max="20" value="5">
        </div>
        <div class="row">
            <div class="piano" id="piano"></div>
        </div>
    </div>
    <div class="content-section">
        <h2>Welcome to CalmSpace</h2>
        <p>CalmSpace is your go-to destination for relaxation and creativity. Designed to provide a soothing and interactive experience, this website offers a variety of tools to help you unwind and express yourself. Whether you're clicking colorful buttons that play calming sounds, rotating knobs for a satisfying tactile experience, coloring abstract shapes, scribbling freely, or playing a virtual piano, CalmSpace has something for everyone.</p>
        <p>Our mission is to create a digital sanctuary where you can take a break from the hustle and bustle of daily life. Each feature is carefully crafted to engage your senses and bring a sense of peace and joy. The sound buttons, for instance, offer a delightful auditory experience with every click, while the coloring and scribbling areas let you unleash your inner artist. The piano adds a musical touch, allowing you to experiment with notes and create your own melodies.</p>
        <p>Why choose CalmSpace? Because we believe in the power of simple, mindful activities to improve your well-being. Studies show that engaging in creative tasks can reduce stress and enhance focus. Whether you're here for a quick five-minute break or a longer session of exploration, CalmSpace adapts to your needs. Our responsive design ensures that you can enjoy it on any device, from desktops to smartphones.</p>
        <p>We’re committed to making CalmSpace a safe and enjoyable space for all users. There’s no pressure here—just pure, unfiltered fun and relaxation. So go ahead, explore the features, and let CalmSpace be your personal retreat whenever you need it most.</p>
    </div>
    <footer>
        <p>Created with ❤️ by <a href="https://dionisio.dev" target="_blank">Dionisio</a> | 2025</p>
    </footer>
    <button class="mute-btn" id="mute-btn">Mute</button>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            let isMuted = false;
            let hasInteracted = false;
            let currentFillFrequency = 350;
            const backgroundMusic = new Audio('music/Sad Piano Wind - Coyote Hearing.mp3');
            backgroundMusic.loop = true;
            let knobVolumes = [0.1, 0.1, 0.1]; // Inicializado em 30% (0.3 total, 0.1 por knob)

            // Função para tocar sons suaves
            function playGeneratedSound(frequency, duration = 0.4, type = 'sine', volume = 0.2) {
                if (isMuted) return;
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                oscillator.type = type;
                oscillator.frequency.value = frequency;
                gainNode.gain.setValueAtTime(volume, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                oscillator.start();
                setTimeout(() => oscillator.stop(), duration * 1000);
            }

            // Atualiza o volume da música baseado nos knobs
            function updateBackgroundVolume() {
                const totalVolume = knobVolumes.reduce((sum, vol) => sum + vol, 0);
                backgroundMusic.volume = isMuted ? 0 : Math.min(totalVolume, 1);
            }

            // Iniciar música na primeira interação
            function startBackgroundMusic() {
                if (!hasInteracted) {
                    updateBackgroundVolume();
                    backgroundMusic.play().catch(e => console.log("Erro ao tocar música de fundo:", e));
                    hasInteracted = true;
                }
            }

            // Mute
            const muteBtn = document.getElementById('mute-btn');
            if (muteBtn) {
                muteBtn.addEventListener('click', () => {
                    isMuted = !isMuted;
                    muteBtn.textContent = isMuted ? 'Unmute' : 'Mute';
                    muteBtn.style.background = isMuted ? '#22c55e' : '#ef4444';
                    updateBackgroundVolume();
                    startBackgroundMusic();
                });
            }

            // Botões sonoros
            document.querySelectorAll('.sound-button').forEach((btn, index) => {
                btn.style.background = `hsl(${Math.random() * 360}, 70%, 70%)`;
                const frequencies = [200, 250, 300, 350];
                btn.addEventListener('click', () => {
                    btn.style.background = `hsl(${Math.random() * 360}, 70%, 70%)`;
                    currentFillFrequency = frequencies[index];
                    playGeneratedSound(frequencies[index]);
                    startBackgroundMusic();
                });
                btn.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    btn.style.background = `hsl(${Math.random() * 360}, 70%, 70%)`;
                    currentFillFrequency = frequencies[index];
                    playGeneratedSound(frequencies[index]);
                    startBackgroundMusic();
                });
            });

            // Knobs giratórios com controle de volume
            function setupKnob(knobId, frequency, index) {
                const knob = document.getElementById(knobId);
                let isDragging = false;
                let angle = 0;
                const maxAngle = 270;

                const startDrag = () => { isDragging = true; startBackgroundMusic(); };
                const stopDrag = () => { isDragging = false; };
                const drag = (e) => {
                    if (isDragging) {
                        const rect = knob.getBoundingClientRect();
                        const centerX = rect.left + rect.width / 2;
                        const centerY = rect.top + rect.height / 2;
                        const deltaX = (e.clientX || e.touches[0].clientX) - centerX;
                        const deltaY = (e.clientY || e.touches[0].clientY) - centerY;
                        let newAngle = Math.atan2(deltaY, deltaX) * (180 / Math.PI) + 90;
                        if (newAngle < 0) newAngle += 360;
                        newAngle = Math.min(Math.max(newAngle, 0), maxAngle);
                        angle = newAngle;
                        knob.style.transform = `rotate(${angle}deg)`;
                        knobVolumes[index] = (angle / maxAngle) * 0.33;
                        updateBackgroundVolume();
                        playGeneratedSound(frequency);
                    }
                };

                knob.addEventListener('mousedown', startDrag);
                knob.addEventListener('touchstart', (e) => { e.preventDefault(); startDrag(); });
                document.addEventListener('mouseup', stopDrag);
                document.addEventListener('touchend', stopDrag);
                document.addEventListener('mousemove', drag);
                document.addEventListener('touchmove', (e) => {
                    e.preventDefault();
                    drag({ clientX: e.touches[0].clientX, clientY: e.touches[0].clientY });
                });

                // Inicializa em 30% (0.1 de 0.33 = ~30°)
                angle = (knobVolumes[index] / 0.33) * maxAngle;
                knob.style.transform = `rotate(${angle}deg)`;
            }
            setupKnob('knob1', 220, 0);
            setupKnob('knob2', 270, 1);
            setupKnob('knob3', 320, 2);

            // Color Picker
            const colorPicker = document.getElementById('color-picker');
            const colors = [
                '#ff6b6b', '#4ecdc4', '#45b7d1', '#96c93d', '#f7d794',
                '#ff9ff3', '#54a0ff', '#00d2d3', '#e84393', '#a29bfe'
            ];
            let selectedColor = colors[0];

            colors.forEach(color => {
                const option = document.createElement('div');
                option.className = 'color-option';
                option.style.background = color;
                option.addEventListener('click', () => {
                    document.querySelectorAll('.color-option').forEach(opt => opt.classList.remove('selected'));
                    option.classList.add('selected');
                    selectedColor = color;
                    startBackgroundMusic();
                });
                colorPicker.appendChild(option);
            });
            colorPicker.children[0].classList.add('selected');

            // Área de colorir
            const coloringCanvas = document.getElementById('coloring-canvas');
            const coloringCtx = coloringCanvas.getContext('2d');
            const clearColoringBtn = document.getElementById('clear-coloring');
            coloringCanvas.width = 400;
            coloringCanvas.height = 200;

            function drawRandomAbstractShapes() {
                coloringCtx.clearRect(0, 0, coloringCanvas.width, coloringCanvas.height);
                coloringCtx.strokeStyle = '#000';
                coloringCtx.lineWidth = 1;

                const shapeCount = Math.floor(Math.random() * 3) + 2;
                for (let i = 0; i < shapeCount; i++) {
                    const shapeType = Math.floor(Math.random() * 4);
                    coloringCtx.beginPath();

                    if (shapeType === 0) {
                        const y = Math.random() * coloringCanvas.height;
                        coloringCtx.moveTo(0, y);
                        coloringCtx.quadraticCurveTo(200, y + (Math.random() * 100 - 50), 400, y);
                        coloringCtx.lineTo(400, coloringCanvas.height);
                        coloringCtx.lineTo(0, coloringCanvas.height);
                        coloringCtx.closePath();
                    } else if (shapeType === 1) {
                        const cx = Math.random() * 400;
                        const cy = Math.random() * 200;
                        const r = Math.random() * 50 + 20;
                        for (let a = 0; a < 360; a += 10) {
                            const rad = (a * Math.PI) / 180;
                            const radius = r + Math.sin(rad * (Math.random() * 5 + 2)) * 10;
                            const x = cx + radius * Math.cos(rad);
                            const y = cy + radius * Math.sin(rad);
                            if (a === 0) coloringCtx.moveTo(x, y);
                            else coloringCtx.lineTo(x, y);
                        }
                        coloringCtx.closePath();
                    } else if (shapeType === 2) {
                        const xStart = Math.random() * 400;
                        coloringCtx.moveTo(xStart, 0);
                        for (let x = xStart; x < xStart + 100 && x < 400; x += 20) {
                            coloringCtx.quadraticCurveTo(x + 10, 100, x + 20, 0);
                        }
                        coloringCtx.lineTo(xStart + 100 > 400 ? 400 : xStart + 100, coloringCanvas.height);
                        coloringCtx.lineTo(xStart, coloringCanvas.height);
                        coloringCtx.closePath();
                    } else {
                        const points = Math.floor(Math.random() * 5) + 3;
                        coloringCtx.moveTo(Math.random() * 400, Math.random() * 200);
                        for (let j = 0; j < points; j++) {
                            coloringCtx.quadraticCurveTo(
                                Math.random() * 400, Math.random() * 200,
                                Math.random() * 400, Math.random() * 200
                            );
                        }
                        coloringCtx.closePath();
                    }
                    coloringCtx.stroke();
                }
            }
            drawRandomAbstractShapes();

            function floodFill(x, y, fillColor) {
                const imageData = coloringCtx.getImageData(0, 0, coloringCanvas.width, coloringCanvas.height);
                const data = imageData.data;
                const targetColor = getPixelColor(x, y, data);
                if (colorsMatch(targetColor, hexToRgb(fillColor))) return;

                const stack = [[x, y]];
                while (stack.length) {
                    const [currX, currY] = stack.pop();
                    const pos = (currY * coloringCanvas.width + currX) * 4;
                    if (currX < 0 || currX >= coloringCanvas.width || currY < 0 || currY >= coloringCanvas.height) continue;
                    if (!colorsMatch(getPixelColor(currX, currY, data), targetColor)) continue;

                    data[pos] = hexToRgb(fillColor)[0];
                    data[pos + 1] = hexToRgb(fillColor)[1];
                    data[pos + 2] = hexToRgb(fillColor)[2];
                    data[pos + 3] = 255;

                    stack.push([currX + 1, currY]);
                    stack.push([currX - 1, currY]);
                    stack.push([currX, currY + 1]);
                    stack.push([currX, currY - 1]);
                }
                coloringCtx.putImageData(imageData, 0, 0);
                playGeneratedSound(currentFillFrequency);
                startBackgroundMusic();
            }

            function getPixelColor(x, y, data) {
                const pos = (y * coloringCanvas.width + x) * 4;
                return [data[pos], data[pos + 1], data[pos + 2], data[pos + 3]];
            }

            function colorsMatch(c1, c2) {
                return c1[0] === c2[0] && c1[1] === c2[1] && c1[2] === c2[2] && c1[3] === c2[3];
            }

            function hexToRgb(hex) {
                const r = parseInt(hex.slice(1, 3), 16);
                const g = parseInt(hex.slice(3, 5), 16);
                const b = parseInt(hex.slice(5, 7), 16);
                return [r, g, b, 255];
            }

            coloringCanvas.addEventListener('click', (e) => {
                const rect = coloringCanvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                floodFill(Math.floor(x), Math.floor(y), selectedColor);
            });
            coloringCanvas.addEventListener('touchstart', (e) => {
                e.preventDefault();
                const rect = coloringCanvas.getBoundingClientRect();
                const x = e.touches[0].clientX - rect.left;
                const y = e.touches[0].clientY - rect.top;
                floodFill(Math.floor(x), Math.floor(y), selectedColor);
            });

            clearColoringBtn.addEventListener('click', () => {
                drawRandomAbstractShapes();
                playGeneratedSound(300);
                startBackgroundMusic();
            });

            // Área de rabiscos
            const scribbleCanvas = document.getElementById('scribble-canvas');
            const scribbleCtx = scribbleCanvas.getContext('2d');
            const lineWidth = document.getElementById('line-width');
            const clearScribbleBtn = document.getElementById('clear-scribble');
            scribbleCanvas.width = 400;
            scribbleCanvas.height = 200;
            let isDrawing = false;

            scribbleCtx.lineCap = 'round';
            scribbleCtx.lineJoin = 'round';

            function startDrawing(e) {
                isDrawing = true;
                scribbleCtx.beginPath();
                scribbleCtx.moveTo(e.offsetX || e.touches[0].clientX - scribbleCanvas.offsetLeft, 
                                  e.offsetY || e.touches[0].clientY - scribbleCanvas.offsetTop);
                scribbleCtx.strokeStyle = selectedColor;
                scribbleCtx.lineWidth = lineWidth.value;
                playGeneratedSound(320);
                startBackgroundMusic();
            }

            function draw(e) {
                if (!isDrawing) return;
                const x = e.offsetX || e.touches[0].clientX - scribbleCanvas.offsetLeft;
                const y = e.offsetY || e.touches[0].clientY - scribbleCanvas.offsetTop;
                scribbleCtx.lineTo(x, y);
                scribbleCtx.stroke();
            }

            function stopDrawing() { isDrawing = false; }

            scribbleCanvas.addEventListener('mousedown', startDrawing);
            scribbleCanvas.addEventListener('mousemove', draw);
            scribbleCanvas.addEventListener('mouseup', stopDrawing);
            scribbleCanvas.addEventListener('touchstart', (e) => { e.preventDefault(); startDrawing(e); });
            scribbleCanvas.addEventListener('touchmove', (e) => { e.preventDefault(); draw(e); });
            scribbleCanvas.addEventListener('touchend', stopDrawing);

            clearScribbleBtn.addEventListener('click', () => {
                scribbleCtx.clearRect(0, 0, scribbleCanvas.width, scribbleCanvas.height);
                playGeneratedSound(300);
                startBackgroundMusic();
            });

            // Piano
            const piano = document.getElementById('piano');
            const notes = ['C4', 'C#4', 'D4', 'D#4', 'E4', 'F4', 'F#4', 'G4', 'G#4', 'A4', 'A#4', 'B4'];
            const blackNotes = [1, 3, 6, 8, 10];

            notes.forEach((note, index) => {
                const key = document.createElement('button');
                key.className = `key ${blackNotes.includes(index) ? 'black' : 'white'}`;
                key.dataset.note = note;
                key.style.background = blackNotes.includes(index) 
                    ? `hsl(${index * 30}, 50%, 30%)` 
                    : `hsl(${index * 30}, 70%, 90%)`;
                piano.appendChild(key);

                key.addEventListener('click', () => {
                    playNote(note);
                    startBackgroundMusic();
                });
                key.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    playNote(note);
                    startBackgroundMusic();
                });
            });

            function playNote(note) {
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                oscillator.type = 'triangle';
                oscillator.frequency.value = noteToFrequency(note);
                gainNode.gain.setValueAtTime(0.5, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                oscillator.start();
                setTimeout(() => oscillator.stop(), 500);
            }

            function noteToFrequency(note) {
                const frequencies = {
                    'C4': 261.63, 'C#4': 277.18, 'D4': 293.66, 'D#4': 311.13,
                    'E4': 329.63, 'F4': 349.23, 'F#4': 369.99, 'G4': 392.00,
                    'G#4': 415.30, 'A4': 440.00, 'A#4': 466.16, 'B4': 493.88
                };
                return frequencies[note];
            }
        });
    </script>
</body>
</html>